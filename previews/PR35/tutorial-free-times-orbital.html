<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Orbital transfer min time · Tutorials</title><meta name="title" content="Orbital transfer min time · Tutorials"/><meta property="og:title" content="Orbital transfer min time · Tutorials"/><meta property="twitter:title" content="Orbital transfer min time · Tutorials"/><meta name="description" content="Documentation for Tutorials."/><meta property="og:description" content="Documentation for Tutorials."/><meta property="twitter:description" content="Documentation for Tutorials."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="https://control-toolbox.org/assets/css/documentation.css" rel="stylesheet" type="text/css"/><script src="https://control-toolbox.org/assets/js/documentation.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Tutorials</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Getting Started</a></li><li><span class="tocitem">Tutorials and Advanced Features</span><ul><li><a class="tocitem" href="tutorial-continuation.html">Discrete continuation</a></li><li><a class="tocitem" href="tutorial-discretisation.html">Discretisation methods</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Free times</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="tutorial-free-times-final.html">Final time</a></li><li><a class="tocitem" href="tutorial-free-times-initial.html">Initial time</a></li><li><a class="tocitem" href="tutorial-free-times-final-initial.html">Final and initial times</a></li><li class="is-active"><a class="tocitem" href="tutorial-free-times-orbital.html">Orbital transfer min time</a><ul class="internal"><li><a class="tocitem" href="#A-more-concrete-example-about-the-change-of-orbit-of-a-satellite:"><span>A more concrete example about the change of orbit of a satellite:</span></a></li><li><a class="tocitem" href="#Here-are-the-required-packages-for-the-tutorial:"><span>Here are the required packages for the tutorial:</span></a></li><li><a class="tocitem" href="#Definition-of-the-problem"><span>Definition of the problem</span></a></li><li class="toplevel"><a class="tocitem" href="#Direct-resolution-with-minimal-orbital-time-:"><span>Direct resolution with minimal orbital time :</span></a></li><li class="toplevel"><a class="tocitem" href="#Indirect-resolution-with-minimal-orbital-time-:"><span>Indirect resolution with minimal orbital time :</span></a></li><li><a class="tocitem" href="#Hamiltonian-and-optimal-control"><span>Hamiltonian and optimal control</span></a></li><li><a class="tocitem" href="#Shooting-function"><span>Shooting function</span></a></li><li><a class="tocitem" href="#Initial-guess-and-solver-setup"><span>Initial guess and solver setup</span></a></li><li><a class="tocitem" href="#Solve-the-shooting-problem"><span>Solve the shooting problem</span></a></li><li><a class="tocitem" href="#Generate-the-indirect-solution-trajectory"><span>Generate the indirect solution trajectory</span></a></li><li class="toplevel"><a class="tocitem" href="#Visualisation-of-results"><span>Visualisation of results</span></a></li></ul></li></ul></li><li><a class="tocitem" href="tutorial-nlp.html">NLP manipulations</a></li><li><a class="tocitem" href="tutorial-iss.html">Indirect simple shooting</a></li><li><a class="tocitem" href="tutorial-goddard.html">Goddard: direct, indirect</a></li><li><a class="tocitem" href="tutorial-lqr.html">Linear–quadratic regulator</a></li><li><a class="tocitem" href="tutorial-mam.html">Minimal action</a></li><li><a class="tocitem" href="tutorial-mpc.html">Model Predictive Control</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials and Advanced Features</a></li><li><a class="is-disabled">Free times</a></li><li class="is-active"><a href="tutorial-free-times-orbital.html">Orbital transfer min time</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tutorial-free-times-orbital.html">Orbital transfer min time</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/control-toolbox/Tutorials.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/control-toolbox/Tutorials.jl/blob/main/docs/src/tutorial-free-times-orbital.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="tutorial-free-times-orbital"><a class="docs-heading-anchor" href="#tutorial-free-times-orbital">Optimal control problem with free final orbital time</a><a id="tutorial-free-times-orbital-1"></a><a class="docs-heading-anchor-permalink" href="#tutorial-free-times-orbital" title="Permalink"></a></h1><h2 id="A-more-concrete-example-about-the-change-of-orbit-of-a-satellite:"><a class="docs-heading-anchor" href="#A-more-concrete-example-about-the-change-of-orbit-of-a-satellite:">A more concrete example about the change of orbit of a satellite:</a><a id="A-more-concrete-example-about-the-change-of-orbit-of-a-satellite:-1"></a><a class="docs-heading-anchor-permalink" href="#A-more-concrete-example-about-the-change-of-orbit-of-a-satellite:" title="Permalink"></a></h2><h2 id="Here-are-the-required-packages-for-the-tutorial:"><a class="docs-heading-anchor" href="#Here-are-the-required-packages-for-the-tutorial:">Here are the required packages for the tutorial:</a><a id="Here-are-the-required-packages-for-the-tutorial:-1"></a><a class="docs-heading-anchor-permalink" href="#Here-are-the-required-packages-for-the-tutorial:" title="Permalink"></a></h2><pre><code class="language-julia hljs">using OptimalControl
using NLPModelsIpopt
using Plots
using Printf
using LinearAlgebra
using NLsolve</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h2 id="Definition-of-the-problem"><a class="docs-heading-anchor" href="#Definition-of-the-problem">Definition of the problem</a><a id="Definition-of-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Definition-of-the-problem" title="Permalink"></a></h2><pre><code class="language-julia hljs">
const x₁₀ = -42272.67       # initial position x
const x₂₀ = 0               # initial position y
const x₃₀ = 0               # initial velocity in x
const x₄₀ = -5696.72        # initial velocity in y
const μ = 5.1658620912*1e12 # gravitational parameter
const γ_max = 0.05          # maximal thrust norm
const r_f = 42165             # target orbit radius (final distance to origin)
const rf3    = r_f^3
const α  = sqrt(μ/rf3);

function min_orbit_tf()
    @def ocp begin
        tf ∈ R, variable
        t ∈ [0, tf], time
        x ∈ R⁴, state
        u ∈ R², control
        u₁(t)^2 + u₂(t)^2 ≤ γ_max^2
        x(0) == [x₁₀, x₂₀, x₃₀, x₄₀]
        x₁(tf)^2 + x₂(tf)^2 == r_f^2
        0.05 ≤ tf ≤ Inf
        ẋ(t) == [
            x₃(t),
            x₄(t),
            -μ * x₁(t) / ((x₁(t)^2 + x₂(t)^2)^(3/2)) + u₁(t),
            -μ * x₂(t) / ((x₁(t)^2 + x₂(t)^2)^(3/2)) + u₂(t)
        ]
        tf → min
    end

    return ocp
end
nothing # hide</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h1 id="Direct-resolution-with-minimal-orbital-time-:"><a class="docs-heading-anchor" href="#Direct-resolution-with-minimal-orbital-time-:">Direct resolution with minimal orbital time :</a><a id="Direct-resolution-with-minimal-orbital-time-:-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-resolution-with-minimal-orbital-time-:" title="Permalink"></a></h1><p>We now solve the problem using a direct method, with automatic treatment of the free initial time.</p><pre><code class="language-julia hljs">ocp = min_orbit_tf()
sol = solve(ocp;init=(variable=13.4,), grid_size=100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><p>And plot the solution.</p><pre><code class="language-julia hljs">plot(sol; label=&quot;direct&quot;, size=(800, 800))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h1 id="Indirect-resolution-with-minimal-orbital-time-:"><a class="docs-heading-anchor" href="#Indirect-resolution-with-minimal-orbital-time-:">Indirect resolution with minimal orbital time :</a><a id="Indirect-resolution-with-minimal-orbital-time-:-1"></a><a class="docs-heading-anchor-permalink" href="#Indirect-resolution-with-minimal-orbital-time-:" title="Permalink"></a></h1><h2 id="Hamiltonian-and-optimal-control"><a class="docs-heading-anchor" href="#Hamiltonian-and-optimal-control">Hamiltonian and optimal control</a><a id="Hamiltonian-and-optimal-control-1"></a><a class="docs-heading-anchor-permalink" href="#Hamiltonian-and-optimal-control" title="Permalink"></a></h2><p>From the Pontryagin Maximum Principle, the optimal control is bang-bang:</p><pre><code class="language-julia hljs">ocp = min_orbit_tf()

function optimal_control(x, p, tf)
    p₃, p₄ = p[3], p[4]
    p_norm = sqrt(p₃^2 + p₄^2)
    
    if p_norm &gt; 1e-10
        u₁ = γ_max * p₃ / p_norm
        u₂ = γ_max * p₄ / p_norm
        return [u₁, u₂]
    else
        return [0.0, 0.0]
    end
end

function hamiltonian(x, p, u)
    x₁, x₂, x₃, x₄ = x
    p₁, p₂, p₃, p₄ = p
    u₁, u₂ = u
    
    r = sqrt(x₁^2 + x₂^2)
    r³ = r^3
    
    return (p₁*x₃ + p₂*x₄ + 
            p₃*(-μ*x₁/r³ + u₁) + 
            p₄*(-μ*x₂/r³ + u₂))
end
# Create flow using OptimalControl.jl
flow = Flow(ocp, optimal_control)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h2 id="Shooting-function"><a class="docs-heading-anchor" href="#Shooting-function">Shooting function</a><a id="Shooting-function-1"></a><a class="docs-heading-anchor-permalink" href="#Shooting-function" title="Permalink"></a></h2><p>The shooting function encodes the boundary conditions:</p><pre><code class="language-julia hljs">function shooting_function!(s, ξ)
    p0 = ξ[1:4]
    tf = ξ[5]

    x0 = [x₁₀, x₂₀, x₃₀, x₄₀]

    try
        # Use OptimalControl.jl Flow interface with variable
        x_final, p_final = flow(0.0, x0, p0, tf, tf)

        x₁f, x₂f, x₃f, x₄f = x_final
        p₁f, p₂f, p₃f, p₄f = p_final

        s[1] = x₁f^2 + x₂f^2 - r_f^2
        s[2] = p₁f
        s[3] = p₂f

        u_final = optimal_control(x_final, p_final, tf)
        H_final = hamiltonian(x_final, p_final, u_final)
        s[4] = H_final

        s[5] = p₁f^2 + p₂f^2 + p₃f^2 + p₄f^2 - 1.0

    catch e
        fill!(s, 1e6)
    end

    return nothing
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h2 id="Initial-guess-and-solver-setup"><a class="docs-heading-anchor" href="#Initial-guess-and-solver-setup">Initial guess and solver setup</a><a id="Initial-guess-and-solver-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-guess-and-solver-setup" title="Permalink"></a></h2><pre><code class="language-julia hljs"># Initial guess for the shooting variables [p₀, tf]

function get_initial_guess()
    tf_guess = 13.4
    
    p0_guess = [1.0323e-4, 4.915e-5, 3.568e-4, -1.554e-4]
    
    return vcat(p0_guess, tf_guess)
end

ξ_init = get_initial_guess()
println(&quot;Initial guess: p₀ = $(ξ_init[1:4]), tf = $(ξ_init[5])&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h2 id="Solve-the-shooting-problem"><a class="docs-heading-anchor" href="#Solve-the-shooting-problem">Solve the shooting problem</a><a id="Solve-the-shooting-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-the-shooting-problem" title="Permalink"></a></h2><pre><code class="language-julia hljs"># Solve the shooting problem using NLsolve
function solve_indirect_method()
    println(&quot;Solving indirect method...&quot;)

    # Set up the shooting problem
    result = nlsolve(shooting_function!, ξ_init,
                    method=:trust_region,
                    ftol=1e-10,
                    xtol=1e-10,
                    iterations=1000,
                    show_trace=false)

    if result.f_converged || result.x_converged
        println(&quot;Shooting method converged!&quot;)
        println(&quot;Final residual norm: $(norm(result.zero))&quot;)
        return result.zero
    else
        println(&quot;Shooting method failed to converge&quot;)
        println(&quot;Final residual norm: $(norm(result.zero))&quot;)
        return nothing
    end
end

ξ_solution = solve_indirect_method()

if ξ_solution !== nothing
    p0_opt = ξ_solution[1:4]
    tf_opt = ξ_solution[5]

    println(&quot;\nOptimal solution:&quot;)
    println(&quot;p₀ = $(p0_opt)&quot;)
    println(&quot;tf = $(tf_opt)&quot;)

    # Verify the solution
    s_check = zeros(5)
    shooting_function!(s_check, ξ_solution)
    println(&quot;Shooting function residual: $(s_check)&quot;)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h2 id="Generate-the-indirect-solution-trajectory"><a class="docs-heading-anchor" href="#Generate-the-indirect-solution-trajectory">Generate the indirect solution trajectory</a><a id="Generate-the-indirect-solution-trajectory-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-the-indirect-solution-trajectory" title="Permalink"></a></h2><pre><code class="language-julia hljs">if ξ_solution !== nothing
    # Generate the optimal trajectory
    x0 = [x₁₀, x₂₀, x₃₀, x₄₀]
    p0_opt = ξ_solution[1:4]
    tf_opt = ξ_solution[5]
    
    # Define time points for plotting FIRST
    t_indirect = range(0, tf_opt, length=1000)
    
    # Solve the optimal trajectory
    sol_indirect = flow((0.0, tf_opt), x0, p0_opt)
    
    # Extract trajectories by evaluating at time points
    x_traj = zeros(length(t_indirect), 4)
    p_traj = zeros(length(t_indirect), 4)
    u_traj = zeros(length(t_indirect), 2)
    
    for (i, t) in enumerate(t_indirect)
        x_traj[i, :], p_traj[i, :] = flow(0.0, x0, p0_opt, t)
        u_traj[i, :] = optimal_control(x_traj[i, :], p_traj[i, :], tf_opt)    
    end

    println(&quot;Indirect solution generated successfully!&quot;)
    println(&quot;Final time: $(tf_opt)&quot;)
    println(&quot;Final position: $(x_traj[end, 1:2])&quot;)
    println(&quot;Final radius: $(sqrt(x_traj[end, 1]^2 + x_traj[end, 2]^2))&quot;)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h1 id="Visualisation-of-results"><a class="docs-heading-anchor" href="#Visualisation-of-results">Visualisation of results</a><a id="Visualisation-of-results-1"></a><a class="docs-heading-anchor-permalink" href="#Visualisation-of-results" title="Permalink"></a></h1><details>
<summary>Click to show/hide indirect method visualization code</summary><pre><code class="language-julia hljs"># Simple visualization - just the basic plots
if ξ_solution !== nothing
    p0_opt = ξ_solution[1:4]
    tf_opt = ξ_solution[5]
    
    x0 = [x₁₀, x₂₀, x₃₀, x₄₀]
    
    t_indirect = range(0, tf_opt, length=1000)
    
    x_traj = zeros(length(t_indirect), 4)
    p_traj = zeros(length(t_indirect), 4)
    u_traj = zeros(length(t_indirect), 2)
    
    # Use flow function directly to evaluate at each time point
    for (i, t) in enumerate(t_indirect)
        x_traj[i, :], p_traj[i, :] = flow(0.0, x0, p0_opt, t)
        u_traj[i, :] = optimal_control(x_traj[i, :], p_traj[i, :], tf_opt)
    end
    
    # Combined plot with 3 rows
    plt = plot(layout=(3,1), size=(800, 900))
    
    plot!(plt[1], t_indirect, [x_traj[:,1] x_traj[:,2] x_traj[:,3] x_traj[:,4]], 
          label=[&quot;x₁&quot; &quot;x₂&quot; &quot;x₃&quot; &quot;x₄&quot;], title=&quot;States&quot;)
    
    plot!(plt[2], t_indirect, [p_traj[:,1] p_traj[:,2] p_traj[:,3] p_traj[:,4]], 
          label=[&quot;p₁&quot; &quot;p₂&quot; &quot;p₃&quot; &quot;p₄&quot;], title=&quot;Costates&quot;)
    
    plot!(plt[3], t_indirect, [u_traj[:,1] u_traj[:,2]], 
          label=[&quot;u₁&quot; &quot;u₂&quot;], title=&quot;Control&quot;)
    
    plt  # This returns the plot for documentation
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre></details></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="tutorial-free-times-final-initial.html">« Final and initial times</a><a class="docs-footer-nextpage" href="tutorial-nlp.html">NLP manipulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Friday 7 November 2025 22:32">Friday 7 November 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
